<div id="detail-modal" class="modal hidden">
    <div class="modal-content large">
        <div class="modal-header">
            <h2>Detalles de Licencia</h2>
            <button class="close-modal" onclick="closeModal('detail-modal')">&times;</button>
        </div>
        <div class="modal-body">

            <!-- Info Header -->
            <div class="detail-header">
                <div>
                    <span class="label">Código</span>
                    <h3 id="detail-code" class="code-mono large">XXXX-XXXX-XXXX</h3>
                </div>
                <div class="status-badge-container">
                    <span id="detail-status" class="badge badge-status">ACTIVE</span>
                </div>
            </div>

            <!-- Edit Form -->
            <form id="edit-form" method="POST" action="">
                <div class="form-row">
                    <div class="form-group">
                        <label>Cliente</label>
                        <input type="text" name="client_name" id="detail-client">
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="text" name="client_phone" id="detail-phone">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea name="notes" id="detail-notes" rows="2"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Max Dispositivos</label>
                        <input type="number" name="max_devices" id="detail-max-devices" min="1">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button type="submit" class="btn btn-secondary full-width">Guardar Cambios</button>
                    </div>
                </div>
            </form>

            <hr>

            <!-- Actions Grid -->
            <div class="actions-grid">

                <!-- Renew -->
                <div class="action-card">
                    <h4>Renovar / Extender</h4>
                    <form id="renew-form" method="POST" action="" class="flex-form">
                        <input type="number" name="days" placeholder="Días" required min="1" value="30">
                        <button type="submit" class="btn btn-primary">Sumar Días</button>
                    </form>
                </div>

                <!-- Block/Unblock -->
                <div class="action-card">
                    <h4>Estado</h4>
                    <form id="block-form" method="POST" action="">
                        <button type="submit" id="btn-block-toggle" class="btn full-width">
                            Bloquear Licencia
                        </button>
                    </form>
                </div>

                <!-- Advanced Options -->
                <div class="action-card">
                    <h4>Opciones Avanzadas</h4>
                    <div style="display: flex; flex-direction: column; gap: 8px;">

                        <!-- Reset Devices -->
                        <form id="reset-devices-form" method="POST" action=""
                            onsubmit="return confirm('¿Estás seguro de resetear los dispositivos? El usuario podrá vincular nuevos.')">
                            <button type="submit" class="btn btn-secondary full-width btn-sm btn-with-icon">
                                <svg viewBox="0 0 24 24" class="btn-icon-svg">
                                    <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                                    <line x1="12" y1="18" x2="12.01" y2="18"></line>
                                </svg>
                                Resetear Dispositivos
                            </button>
                        </form>

                        <!-- Regenerate Code -->
                        <form id="regenerate-code-form" method="POST" action=""
                            onsubmit="return confirm('⚠ ATENCIÓN: Esto invalidará el código actual. El usuario necesitará el nuevo código. ¿Continuar?')">
                            <button type="submit" class="btn btn-secondary full-width btn-sm btn-with-icon">
                                <svg viewBox="0 0 24 24" class="btn-icon-svg">
                                    <path
                                        d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4">
                                    </path>
                                </svg>
                                Regenerar Código
                            </button>
                        </form>

                        <!-- Duplicate -->
                        <button type="button" class="btn btn-primary full-width btn-sm btn-with-icon"
                            onclick="duplicateLicenseFromDetail()">
                            <svg viewBox="0 0 24 24" class="btn-icon-svg">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Duplicar Licencia
                        </button>
                    </div>
                </div>

                <!-- Delete -->
                <div class="action-card danger">
                    <h4>Zona de Peligro</h4>
                    <button onclick="openConfirmDialog()" class="btn btn-danger full-width">
                        Eliminar Licencia
                    </button>
                </div>
            </div>

            <!-- Devices List -->
            <div class="devices-section">
                <h4>Dispositivos Registrados (<span id="device-count">0</span>)</h4>
                <ul id="device-list" class="device-list">
                    <!-- JS populated -->
                </ul>
            </div>

        </div>
    </div>
</div>

<form id="delete-form" method="POST" action="" style="display:none;"></form>